machine:
  services:
    - docker

dependencies:
  override:
    - docker info

test:
  override:
    - cd nginx && docker build -t base:nginx ./:
        timeout: 3600
    - cd shadowsocks && docker build -t base:shadowsocks .
    - cd ocserv && docker build -t base:ocserv .
    - docker run -d base:nginx
    - docker run --restart=always -p 11111:8388 -p 11111:8388/udp -e "METHOD=aes-256-cfb" -e "PASSWORD=Arizona" -d base:shadowsocks
    - cd ocserv && docker run -v conf:/etc/ocserv -d base:ocserv ocserv -f -c /etc/ocserv/sample.config
    - docker images -a --digests
    - docker history base:nginx
    - docker history base:shadowsocks
    - docker ps
